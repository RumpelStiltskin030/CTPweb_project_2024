@model IEnumerable<HomeWorks.ViewModel.ProductVM>
@inject IHttpContextAccessor HttpContextAccessor
<div class="row">
    <!-- 側邊選單 -->
    <div class="col-12 col-md-3 col-lg-2">
        @await Html.PartialAsync("~/Views/Shared/view/MeChose.cshtml")
    </div>
    <div class="col-12 col-md-9 col-lg-10">
@{
    ViewData["Title"] = "我的產品";
    string id = HttpContextAccessor.HttpContext.Session.GetString("LoggedInID")?.Trim();
}

<h1>@ViewData["Title"]</h1>

<p>
    <a asp-action="Create" class="btn btn-success text-end">新增產品</a>
</p>

<!-- 使用 Bootstrap 網格系統 -->
<div class="container">
    <div class="row">
        @foreach (var item in Model)
        {
            if (item.Product.MeId == id)
            {
              if (item.Product.Status != "D") 
              { 
                        string src = "";
                if (item.ProductDetail.Count > 0)
                {
                    src = item.ProductDetail[0].Fieldpath;
                }

                <div class="col-md-4 mb-4">
                    <div class="card custom-card">
                        <img src="@src" class="card-img-top" alt="產品圖片">
                        <div class="card-body">
                            @if (item.Product.Status == "A")
                            {
                                <h5 class="card-title"> @Html.DisplayFor(modelItem => item.Product.ProName)</h5>
                            }
                            @if (item.Product.Status == "B")
                            {
                                <h5 class="card-title"> @Html.DisplayFor(modelItem => item.Product.ProName) (已訂購)</h5>
                            }
                            @if (item.Product.Status == "C")
                            {
                                <h5 class="card-title"> @Html.DisplayFor(modelItem => item.Product.ProName) (已售出)</h5>
                            }
                            <p class="card-text">@Html.DisplayFor(modelItem => item.Product.ProPrice)</p>
                            @if (item.Product.Status != "C")
                            {
                            <a href="#" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#EditModal" data-product-id="@item.Product.ProId">
                                編輯
                            </a>
                            <a asp-action="Details" asp-route-id="@item.Product.ProId" class="btn btn-primary">預覽</a>
                            }
                            <a href="#" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#DeleteModal" data-product-id="@item.Product.ProId">
                                刪除
                            </a>
                        </div>
                    </div>
                </div>
            }
            }
        }
    </div>
</div>
    </div>
<!-- Modal -->
<div class="modal fade" id="EditModal" tabindex="-1" aria-labelledby="EditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="EditModalLabel">修改產品資料</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body-content">
                <!-- 編輯內容會載入到這裡 -->
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" aria-labelledby="DeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="DeleteModalLabel">刪除產品資料</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-delete-body-content">
                <!-- 編輯內容會載入到這裡 -->
            </div>
        </div>
    </div>
</div>
<!-- 確保 jQuery 和 Bootstrap JS 加載 -->
@* <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> *@

@section Scripts {
    <script>
        $(document).on('click', '[class="btn btn-warning"]', function () {
            var productId = $(this).data('product-id'); // 獲取產品 ID
            var url = '@Url.Action("Edit", "Products")' + '?id=' + productId;
            $('#modal-body-content').load(url);
        });
    </script>
    <script>
        $(document).on('click', '[class="btn btn-danger"]', function () {
            var productId = $(this).data('product-id'); // 獲取產品 ID
            var url = '@Url.Action("Delete", "Products")' + '?id=' + productId;
            $('#modal-delete-body-content').load(url);
        });
    </script>
}

<style>
    .custom-card {
        width: 100%;
        height: 600px; /* 固定卡片高度 */
    }

        .custom-card .card-img-top {
            height: 450px; /* 設置圖片的高度 */
            object-fit: cover; /* 保持圖片的比例並填滿卡片 */
        }
</style>
